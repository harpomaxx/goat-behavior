schema: '2.0'
stages:
  preprocess:
    cmd: Rscript code/R/scripts/prepare_dataset.R --input rawdata/seba-caprino-feature-engineering-seba-abdel.tsv
      --output data/preprocessed/seba-caprino-preprocessed.tsv
    deps:
    - path: code/R/scripts/create_lag_features.R
      md5: 3a98b3ada91e90779a10f55547079d2f
      size: 2323
    - path: code/R/scripts/create_numeric_features.R
      md5: 50e383f27ae20404555e2f4f792390a8
      size: 2091
    - path: code/R/scripts/prepare_dataset.R
      md5: fe6b0b3d5906f532a6afaaee685c0974
      size: 1079
    - path: rawdata/seba-caprino-feature-engineering-seba-abdel.tsv
      md5: 1203d468e72db3b5c47e1d45a8f5bdcb
      size: 266391
    outs:
    - path: data/preprocessed
      md5: e08039bc9068ff29f37cef575b77a82d.dir
      size: 463618
      nfiles: 1
  select_initial_features:
    cmd: Rscript code/R/scripts/020_select_initial_features_cmd.R --input data/preprocessed/seba-caprino-preprocessed.tsv
      --output data/initial_features/seba-caprino-preprocessed-initial-features.tsv
    deps:
    - path: code/R/functions/select_initial_features.R
      md5: af6f134cb3696389ad537930af81b4a2
      size: 1988
    - path: code/R/scripts/020_select_initial_features_cmd.R
      md5: 3993e31fd1481af436519633bd8a05dd
      size: 1124
    - path: data/preprocessed/seba-caprino-preprocessed.tsv
      md5: ca5a85b5b1ecee251f2ee46ac04eea57
      size: 463618
    outs:
    - path: data/initial_features
      md5: 8eee419eabb2dab478b30bffbcddb7c9.dir
      size: 378331
      nfiles: 1
    - path: metrics/select_features_initial.yaml
      md5: 80447d2ddc16a1be26c8d3be1c8d0159
      size: 23
  split_train_test:
    cmd: Rscript code/R/scripts/separate_train_test_dataset.R --input data/initial_features/seba-caprino-preprocessed-initial-features.tsv
      --output data/split/seba-caprino
    deps:
    - path: code/R/scripts/separate_train_test.R
      md5: 958ff937774a9e87df83e6256356d724
      size: 452
    - path: code/R/scripts/separate_train_test_dataset.R
      md5: 1d6186a5d46793ebf68542b84ec9ce8b
      size: 1257
    - path: data/initial_features/seba-caprino-preprocessed-initial-features.tsv
      md5: 2f84b0847baeb584a7a68290e21bb8f3
      size: 378331
    outs:
    - path: data/split
      md5: 3ca50d93fe9a65d8c7c713b59168205f.dir
      size: 378710
      nfiles: 2
  select_boruta_dataset:
    cmd: Rscript code/R/scripts/select_features_boruta_dataset.R --input data/split/seba-caprino_trainset.tsv
      --output data/topnfeatures/seba-caprino --numsamp 2
    deps:
    - path: code/R/scripts/select_features_boruta.R
      md5: e89c2eb88928d006b001aca3a5daccef
      size: 3415
    - path: code/R/scripts/select_features_boruta_dataset.R
      md5: 83bd50077f553acc7e6bb6e121c66cec
      size: 1723
    - path: data/split/seba-caprino_trainset.tsv
      md5: 2acc64c28713f1b815e4595cabc08c62
      size: 183581
    outs:
    - path: data/topnfeatures
      md5: 163ce0008cd8339f1fa483a3de477342.dir
      size: 355
      nfiles: 1
  select_boruta_features:
    cmd: Rscript code/R/scripts/select_features_boruta_dataset.R --input data/split/seba-caprino_trainset.tsv
      --output data/topnfeatures/seba-caprino
    deps:
    - path: code/R/scripts/select_features_boruta.R
      md5: e89c2eb88928d006b001aca3a5daccef
      size: 3415
    - path: code/R/scripts/select_features_boruta_dataset.R
      md5: c8d895529fcc8dda639f59e16c366509
      size: 2210
    - path: data/split/seba-caprino_trainset.tsv
      md5: 2acc64c28713f1b815e4595cabc08c62
      size: 183581
    params:
      params.yaml:
        select_boruta_features.maxnfeat: 20
        select_boruta_features.numsamp: 2
    outs:
    - path: data/topnfeatures
      md5: ca529fc9c18b5daa5a8e19c835e9fd22.dir
      size: 164
      nfiles: 1
  select_features_boruta:
    cmd: Rscript code/R/scripts/040_select_features_boruta_cmd.R --input data/split/seba-caprino_features.tsv
      --output data/topnfeatures/seba-caprino
    deps:
    - path: code/R/functions/select_features_boruta.R
      md5: 1a5223d102b81632e1457c260d017332
      size: 3649
    - path: code/R/scripts/040_select_features_boruta_cmd.R
      md5: 8430c2b2179e7c0002d7613b62037f86
      size: 2405
    - path: data/split/seba-caprino_features.tsv
      md5: fdb6d6bab33ef900a56e76f4ccbe77ad
      size: 164693
    params:
      params.yaml:
        select_features_boruta.maxnfeat: 20
        select_features_boruta.numsamp: 30
    outs:
    - path: data/topnfeatures
      md5: f9789e0fa9373a74486ae2531b50c0b2.dir
      size: 106
      nfiles: 1
    - path: metrics/select_features_boruta.yaml
      md5: 1f49accfc624936760c95e52d0b83ae7
      size: 22
  separate_train_test:
    cmd: Rscript code/R/scripts/separate_train_test_dataset.R --input data/initial_features/seba-caprino-preprocessed-initial-features.tsv
      --output data/split/seba-caprino
    deps:
    - path: code/R/scripts/separate_train_test.R
      md5: 50639a79ea7704762c5425f8ff9a9c54
      size: 578
    - path: code/R/scripts/separate_train_test_dataset.R
      md5: a733437a7c189615cca0cc16ab3326fd
      size: 1787
    - path: data/initial_features/seba-caprino-preprocessed-initial-features.tsv
      md5: 2f84b0847baeb584a7a68290e21bb8f3
      size: 378331
    params:
      params.yaml:
        separate_train_test.excluded_anim:
        - 1553
        - 1635
        - 1779
        - 505081
        - 505075
        - 505080
    outs:
    - path: data/split
      md5: 3ca50d93fe9a65d8c7c713b59168205f.dir
      size: 378710
      nfiles: 2
    - path: separate_train_test.yaml
      md5: 088183b4d0ee1bb2ebb17581dbe40317
      size: 48
  train_model:
    cmd: Rscript code/R/scripts/050_train_model_cmd.R --input data/split/seba-caprino_loocv.tsv
      --selected_variables data/topnfeatures/seba-caprino_selected_features.tsv --model
      models/boost/seba-caprino
    deps:
    - path: code/R/functions/caret_params.R
      md5: a460f5d68d4ec3e276d9d9e5acb1d4c2
      size: 567
    - path: code/R/functions/train_model.R
      md5: dac8319c3b5204db2dad83c6d019c4c5
      size: 1782
    - path: code/R/scripts/050_train_model_cmd.R
      md5: 542750f11860796c5f9d11000aea29e6
      size: 4314
    - path: data/split/seba-caprino_loocv.tsv
      md5: 3129565550643e846b753a73262860dc
      size: 174760
    - path: data/topnfeatures/seba-caprino_selected_features.tsv
      md5: 044a0a1be23525a871ef6fb4906ee0f0
      size: 106
    params:
      params.yaml:
        train_model:
          depth: 4
          learning_rate: 0.05
          iterations: 1000
          l2_leaf_reg: 3.0
          rsm: 1
          border_count: 64
          vfrac: 0.1
    outs:
    - path: metrics/train_model_metrics_G.yaml
      md5: be0f5f531f0db7d8d8f085700c231288
      size: 74
    - path: metrics/train_model_metrics_GM.yaml
      md5: 7d037fe0a95bc98c57be9fc8f91294ba
      size: 76
    - path: metrics/train_model_metrics_R.yaml
      md5: 670327dc337f2d5d8676092957c361e9
      size: 75
    - path: metrics/train_model_metrics_W.yaml
      md5: 4a4b6f64cadce5c0f65c44fe38ba73ba
      size: 76
    - path: metrics/train_model_predictions.csv
      md5: 514dd175371cd37373bb35a3fff902dc
      size: 2923
    - path: metrics/train_model_resample.yaml
      md5: fd8c140ae840106ac9f45fa5af6b93fb
      size: 120
    - path: models/boost
      md5: 05b036dcf254958cde1768ea8bde6315.dir
      size: 129056
      nfiles: 1
  separate_dataset:
    cmd: Rscript code/R/scripts/030_separate_dataset_cmd.R --input data/initial_features/seba-caprino-preprocessed-initial-features.tsv
      --output data/split/seba-caprino
    deps:
    - path: code/R/functions/separate_dataset.R
      md5: 33ba754c90d06df1764d51534a1a7885
      size: 722
    - path: code/R/scripts/030_separate_dataset_cmd.R
      md5: 82bed98f7642328ba6237ab4481f56f0
      size: 1891
    - path: data/initial_features/seba-caprino-preprocessed-initial-features.tsv
      md5: a48558c4e0448fd698955e6f2a3936da
      size: 339082
    params:
      params.yaml:
        separate_dataset.excluded_anim:
        - 1553
        - 1635
        - 1779
        - 505081
        - 505075
        - 505080
    outs:
    - path: data/split
      md5: 5e17eca2bf81952092e29f5a13ae9a1c.dir
      size: 339453
      nfiles: 2
    - path: metrics/separate_dataset.yaml
      md5: 7a3c2936c4d71e4b504956a770ab8983
      size: 46
  prepare_dataset:
    cmd: Rscript code/R/scripts/010_prepare_dataset_cmd.R --input rawdata/seba-caprino-feature-engineering-seba-abdel.tsv
      --output data/preprocessed/seba-caprino-preprocessed.tsv
    deps:
    - path: code/R/functions/create_lag_features.R
      md5: 051b21a6bc1f51692fc7bdfba94e8e36
      size: 2699
    - path: code/R/functions/create_numeric_features.R
      md5: 933d56229b8264482eb3d65e82deea99
      size: 2120
    - path: code/R/scripts/010_prepare_dataset_cmd.R
      md5: 8d7e26c4f5fedb6684048247503d2bc8
      size: 1083
    - path: rawdata/seba-caprino-feature-engineering-seba-abdel.tsv
      md5: 0f7b713988aba8bb854605744161277a
      size: 265696
    outs:
    - path: data/preprocessed
      md5: d4084ccd6ebe677d7279c187ab31c055.dir
      size: 498004
      nfiles: 1
  select_features_initial:
    cmd: Rscript code/R/scripts/020_select_features_initial_cmd.R --input data/preprocessed/seba-caprino-preprocessed.tsv
      --output data/initial_features/seba-caprino-preprocessed-initial-features.tsv
    deps:
    - path: code/R/functions/select_features_initial.R
      md5: 7b8e4cb91bceac13305df3422d086fa9
      size: 924
    - path: code/R/scripts/020_select_features_initial_cmd.R
      md5: 3e79a16c9a0d8a6d58714168c72957eb
      size: 1371
    - path: data/preprocessed/seba-caprino-preprocessed.tsv
      md5: 13918003371669c1245c89ab17e06bf7
      size: 498004
    params:
      params.yaml:
        select_initial.features:
        - Anim
        - Standing
        - Active
        - Lying
        - '%HeadDown'
        - DFL1
        - DFL2
        - DFL3
        - DFA12
        - DFA123
        - DBL1
        - DBL2
        - DBL3
        - DBA12
        - DBA123
        - X_Actlog
        - Y_Actlog
        - Stepslog
        - distance(m)
        - VarXYlog
        - DiffXYlog
        - MeanXYlog
        - prev_Active1
        - prev_Active1
        - prev_Active2
        - prev_Active3
        - prev_Standing1
        - prev_Standing2
        - prev_Standing3
        - prev_Lying1
        - prev_Lying2
        - prev_Lying3
        - prev_steps1
        - prev_steps2
        - prev_steps3
        - prev_headdown1
        - prev_headdown2
        - prev_headdown3
    outs:
    - path: data/initial_features
      md5: c96791701dc0b79db5339a6d87d23298.dir
      size: 339082
      nfiles: 1
    - path: metrics/select_features_initial.yaml
      md5: d49966b25bd843624ef991eed7a37d4e
      size: 23
  train_model_loocv:
    cmd: Rscript code/R/scripts/060_train_model_loocv_cmd.R --input data/split/seba-caprino_loocv.tsv
      --selected_variables data/topnfeatures/seba-caprino_selected_features.tsv --results
      models/loocv/seba-caprino
    deps:
    - path: code/R/functions/caret_params.R
      md5: a460f5d68d4ec3e276d9d9e5acb1d4c2
      size: 567
    - path: code/R/functions/train_model_loocv.R
      md5: 44bee2ac80c48a78c05ff7f25aa318a7
      size: 5825
    - path: code/R/scripts/060_train_model_loocv_cmd.R
      md5: 9a52eff4be2e69bbcd0f1d511eac5618
      size: 3719
    - path: data/split/seba-caprino_loocv.tsv
      md5: 3129565550643e846b753a73262860dc
      size: 174760
    - path: data/topnfeatures/seba-caprino_selected_features.tsv
      md5: 044a0a1be23525a871ef6fb4906ee0f0
      size: 106
    params:
      params.yaml:
        train_model:
          depth: 4
          learning_rate: 0.05
          iterations: 1000
          l2_leaf_reg: 3.0
          rsm: 1
          border_count: 64
          vfrac: 0.1
    outs:
    - path: metrics/train_model_loocv_metrics_G.yaml
      md5: c96b2374a0f5d291571118a6d6cd5d6e
      size: 121
    - path: metrics/train_model_loocv_metrics_GM.yaml
      md5: 3678c6f3f7375d65293c1b7565b94e49
      size: 120
    - path: metrics/train_model_loocv_metrics_R.yaml
      md5: d5d422ae4f4272f1611bb00ebe543912
      size: 120
    - path: metrics/train_model_loocv_metrics_W.yaml
      md5: 2a3d79ab93ab6fd34db44b11b476db5b
      size: 120
    - path: metrics/train_model_loocv_metrics_micro.yaml
      md5: 121587d495c86bccc08c835ce1b5b306
      size: 82
    - path: metrics/train_model_loocv_metrics_overall.yaml
      md5: a719ccaa9424686a16bf0dd8766dac0a
      size: 121
    - path: models/loocv
      md5: 228aab686234a28e9057680dcd86eba7.dir
      size: 2237941
      nfiles: 1
  calculate_shap:
    cmd: Rscript code/R/scripts/070_calculate_shap_cmd.R --input data/split/seba-caprino_features.tsv
      --model models/boost/seba-caprino_model.rds --output data/shap/shap_values.tsv
      --selected_variables data/topnfeatures/seba-caprino_selected_features.tsv
    deps:
    - path: code/R/functions/calculate_shap.R
      md5: cd6fc5499d44d4bae03931e6663946ba
      size: 4116
    - path: code/R/scripts/070_calculate_shap_cmd.R
      md5: 5e97b8bd96547bc1429ee5a3d06a7a7c
      size: 2493
    - path: data/split/seba-caprino_features.tsv
      md5: fdb6d6bab33ef900a56e76f4ccbe77ad
      size: 164693
    - path: data/topnfeatures/seba-caprino_selected_features.tsv
      md5: 044a0a1be23525a871ef6fb4906ee0f0
      size: 106
    - path: models/boost/seba-caprino_model.rds
      md5: 45a391016ad5603049f571d66014d584
      size: 129056
    params:
      params.yaml:
        calculate_shap.nsim: 10
    outs:
    - path: data/shap
      md5: 3130c663cafc9d0b3e91d6ea3819a627.dir
      size: 118542
      nfiles: 1
  plot_shap:
    cmd: Rscript code/R/scripts/075_plot_shap_cmd.R --input data/split/seba-caprino_features.tsv
      --shapvalues data/shap/shap_values.tsv --output images/shap --selected_variables
      data/topnfeatures/seba-caprino_selected_features.tsv
    deps:
    - path: code/R/functions/calculate_shap.R
      md5: cd6fc5499d44d4bae03931e6663946ba
      size: 4116
    - path: code/R/functions/plot_shap.R
      md5: 4685e5e0f7fad7b1e1b4239de35158ce
      size: 1557
    - path: code/R/scripts/070_calculate_shap_cmd.R
      md5: 5e97b8bd96547bc1429ee5a3d06a7a7c
      size: 2493
    - path: code/R/scripts/075_plot_shap_cmd.R
      md5: 7d8aa548717d02e93f5477104f5efe46
      size: 2450
    - path: data/shap/shap_values.tsv
      md5: f52149205def0420c33d765eaf9132ad
      size: 118542
    - path: data/split/seba-caprino_features.tsv
      md5: fdb6d6bab33ef900a56e76f4ccbe77ad
      size: 164693
    - path: data/topnfeatures/seba-caprino_selected_features.tsv
      md5: 044a0a1be23525a871ef6fb4906ee0f0
      size: 106
    outs:
    - path: images/shap
      md5: fd824a78ef3de3fdd638f880f15195e1.dir
      size: 254683
      nfiles: 2
